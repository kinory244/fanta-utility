<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Riconferme FantaTaxo</title>
<link href="https://cdn.jsdelivr.net/npm/tabulator-tables@6.2.5/dist/css/tabulator.min.css" rel="stylesheet">
<style>
  :root {
    --bg: #0b1020;
    --card: #121a33;
    --text: #e8ecff;
    --muted: #9fb0ff;
    --accent: #7aa2ff;
    --chip: #1a2447;
    --chip-text: #cfe0ff;
    --reconfirm-bg: #0a3d2a33;
    --reconfirm-border: #2bd48a;
  }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; background: linear-gradient(180deg, var(--bg), #0d1530); color: var(--text); }
  .wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
  header { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  h1 { font-size: 1.4rem; margin: 0; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; width:100%; margin-top: 8px; }
  .controls select, .controls input { background: var(--card); border: 1px solid #243058; color: var(--text); padding: 10px 12px; border-radius: 12px; outline:none; min-width:150px; }
  .controls button { background: var(--accent); border: none; color: #0a0f20; padding: 10px 14px; border-radius: 12px; font-weight: 700; }
  #legend { margin-top: 10px; }
  .legend-chip { display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius: 10px; background: var(--card); border:1px solid #1a2447; font-size: 0.95rem; }
  .legend-color { width:14px; height:14px; border-radius:4px; background: var(--reconfirm-bg); border: 2px solid var(--reconfirm-border); }
  #table { background: var(--card); border-radius:16px; overflow:hidden; border:1px solid #1a2447; margin-top: 12px; }
  .tabulator { background: transparent; }
  .tabulator-row.reconfirm { background: var(--reconfirm-bg); border-left: 3px solid var(--reconfirm-border); }
  .footer { opacity:.7; font-size:.85rem; padding:12px 0; }
  .col-toggle { display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px; }
  .col-toggle label { background: var(--card); border:1px solid #243058; padding:6px 10px; border-radius:10px; display:inline-flex; align-items:center; gap:6px; }
  @media (max-width: 600px) { .controls select { min-width: 120px; flex:1; } }
</style>
</head>
<body>
<div class="wrap">
  <header><h1>ðŸ“Š Riconferme FantaTaxo</h1></header>
  <header><h3>Vista l'aggiunta di nuovi team e il grado di competitivitÃ  maggiore con 10 squadre, sarÃ  accettata una sola riconferma per squadra per giocatori con cartellino non superiore a 5 crediti. Alle nuove squadre saranno attribuiti 15 crediti extra per sopperire al disequilibrio.</h3></header>

  <section class="controls">
    <select id="ownerFilter"><option value="">Tutti i proprietari</option></select>
    <select id="ruoloFilter"><option value="">Tutti i ruoli</option><option value="A">A</option><option value="C">C</option><option value="D">D</option><option value="P">P</option></select>
    <select id="teamFilter"><option value="">Tutte le squadre (club)</option><option value="ATA">ATA</option><option value="BOL">BOL</option><option value="CAG">CAG</option><option value="COM">COM</option><option value="EMP">EMP</option><option value="FIO">FIO</option><option value="GEN">GEN</option><option value="INT">INT</option><option value="JUV">JUV</option><option value="LAZ">LAZ</option><option value="LEC">LEC</option><option value="MIL">MIL</option><option value="MON">MON</option><option value="NAP">NAP</option><option value="PAR">PAR</option><option value="ROM">ROM</option><option value="TOR">TOR</option><option value="UDI">UDI</option><option value="VEN">VEN</option><option value="VER">VER</option></select>
    <input id="searchBox" type="search" placeholder="Cerca nome giocatoreâ€¦" />
    <button id="resetBtn">Reset filtri</button>
  </section>

  <div id="legend">
    <span class="legend-chip">
      <span class="legend-color"></span>
      Evidenziati = Prezzo d'asta â‰¤ 5 <b>e non Portieri</b> â‡’ potenziale <b>riconferma</b> (a 2Ã— il prezzo d'asta)
    </span>
  </div>

  <div class="col-toggle" id="colToggles"></div>

  <div id="table"></div>

  <p class="footer">Suggerimenti: tocca le intestazioni per ordinare â€¢ Trascina le colonne per riordinarle â€¢ Usa i toggle per mostrare/nascondere colonne.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/tabulator-tables@6.2.5/dist/js/tabulator.min.js"></script>
<script type="module">
import data from './data.js';

const fmt0 = (n) => new Intl.NumberFormat('it-IT', { maximumFractionDigits: 0 }).format(n);

const columns = [
  { key:"Squadra", title: "Proprietario", field: "Squadra", widthGrow: 1, visible: true },
  { key:"Nome", title: "Nome", field: "Nome", widthGrow: 2, visible: true },
  { key:"Club", title: "Club", field: "Squadra_Appartenenza", widthGrow: 1, visible: true },
  { key:"Ruolo", title: "Ruolo", field: "Ruolo", widthGrow: 1, visible: false },
  { key:"Ruoli_Mantra", title: "Ruoli Mantra", field: "Ruoli_Mantra", widthGrow: 1.2, visible: true },
  { key:"Prezzo", title: "Prezzo", field: "Prezzo", hozAlign:"right", widthGrow: 1, formatter:(cell)=>fmt0(cell.getValue()), visible: true },
  { key:"Quot", title: "Quot.", field: "Quotazione", hozAlign:"right", widthGrow: 1, visible: false },
  { key:"QuotM", title: "Quot. Mantra", field: "Quotazione_Mantra", hozAlign:"right", widthGrow: 1, visible: false },
  { key:"Riconferma", title: "Riconferma (2Ã—)", field: "Prezzo", hozAlign:"right", widthGrow: 1,
    formatter:(cell)=>{ const d = cell.getRow().getData(); const v = Number(d.Prezzo); return (v<=5 && d.Ruolo!=="P") ? fmt0(v*2) : "â€”"; }, visible: true },
  { key:"ID", title: "ID", field: "Fantacalcio_Id", visible:false }
];

let table = new Tabulator("#table", {
  data: data,
  layout: "fitColumns",
  responsiveLayout: "collapse",
  movableColumns: true,
  height: "75vh",
  columns: columns,
  rowFormatter: function(row){
    const d = row.getData();
    const isReconfirm = Number(d.Prezzo) <= 5 && d.Ruolo !== "P";
    row.getElement().classList.toggle("reconfirm", isReconfirm);
  }
});

// Column toggles
const colToggles = document.getElementById("colToggles");
columns.forEach(col => {
  if (col.key === "ID") return;
  const id = "chk_" + col.key;
  const label = document.createElement("label");
  const input = document.createElement("input");
  input.type = "checkbox";
  input.id = id;
  input.checked = !!col.visible;
  input.addEventListener("change", () => {
    (input.checked ? table.showColumn(col.field) : table.hideColumn(col.field));
  });
  label.appendChild(input);
  label.appendChild(document.createTextNode(" " + col.title));
  colToggles.appendChild(label);
});
columns.forEach(col => { if (col.visible === false) table.hideColumn(col.field); });

// Filters
const ownerFilter = document.getElementById("ownerFilter");
const ruoloFilter = document.getElementById("ruoloFilter");
const teamFilter = document.getElementById("teamFilter");
const searchBox = document.getElementById("searchBox");
const resetBtn = document.getElementById("resetBtn");

// Popola dinamicamente i proprietari
const owners = [...new Set(data.map(d => d.Squadra))].sort();
owners.forEach(o => {
  const opt = document.createElement("option");
  opt.value = o;
  opt.textContent = o;
  ownerFilter.appendChild(opt);
});

function applyFilters() {
  let filters = [];
  if (ownerFilter.value) filters.push({ field:"Squadra", type:"=", value: ownerFilter.value });
  if (ruoloFilter.value) filters.push({ field:"Ruolo", type:"=", value: ruoloFilter.value });
  if (teamFilter.value) filters.push({ field:"Squadra_Appartenenza", type:"=", value: teamFilter.value });

  table.clearFilter(true);
  if (filters.length) table.setFilter(filters);
  if (searchBox.value) {
    const q = searchBox.value.toLowerCase();
    table.addFilter((data) => (data.Nome || '').toLowerCase().includes(q));
  }
}

ownerFilter.addEventListener("change", applyFilters);
ruoloFilter.addEventListener("change", applyFilters);
teamFilter.addEventListener("change", applyFilters);
searchBox.addEventListener("input", applyFilters);
resetBtn.addEventListener("click", () => {
  ownerFilter.value = "";
  ruoloFilter.value = "";
  teamFilter.value = "";
  searchBox.value = "";
  table.clearFilter(true);
});
</script>
</body>
</html>
